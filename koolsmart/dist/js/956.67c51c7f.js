"use strict";(self["webpackChunkxiaolou"]=self["webpackChunkxiaolou"]||[]).push([[956],{4956:function(t,e,s){s.r(e),s.d(e,{default:function(){return k}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"allScenario"},[e("div",{staticClass:"main"},[e("div",{staticClass:"middle"},[e("div",{staticClass:"left"},["1"===t.show?e("Device"):t._e(),"2"===t.show?e("Entity"):t._e(),"3"===t.show?e("Automation"):t._e()],1),e("div",{staticClass:"right"},[e("div",{staticClass:"name"},[e("el-form",[e("el-form-item",{attrs:{model:t.form}},[e("el-input",{ref:"input",model:{value:t.projectName,callback:function(e){t.projectName=e},expression:"projectName"}})],1)],1),e("i",{staticClass:"icon iconfont icon-baocun",on:{click:t.saveProjectName}})],1),e("div",{staticClass:"image",on:{dragover:t.dragOver,drop:function(e){return t.drop(e)}}},[e("el-empty",{directives:[{name:"show",rawName:"v-show",value:""==t.currentScenario,expression:"currentScenario == ''"}],attrs:{description:"Please select a scenario"}}),e("el-image",{directives:[{name:"show",rawName:"v-show",value:""!=t.currentScenario,expression:"currentScenario != ''"}],attrs:{src:t.bigImage,fit:"fill"}}),t._l(t.add_icons,(function(s){return e("div",{key:s.id,style:{position:"absolute",left:s.left,top:s.top,height:"36px",width:"36px",fontSize:"30px",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",backgroundColor:"rgba(224, 150, 58,0.95)",boxShadow:"0px 0px 8px 3px rgba(224, 150, 58, 0.5)"},on:{dragstart:function(e){return t.dragStart(s)}}},[e("span",{directives:[{name:"show",rawName:"v-show",value:!s.show_img,expression:"!item.show_img"}],class:s.icon,attrs:{draggable:!0}}),e("img",{directives:[{name:"show",rawName:"v-show",value:s.show_img,expression:"item.show_img"}],staticStyle:{height:"100%",width:"100%"},attrs:{src:s.img,draggable:!0}})])}))],2),e("div",{staticClass:"scroll"},[e("i",{staticClass:"el-icon-arrow-left",staticStyle:{cursor:"pointer"},on:{click:t.leftMove}}),e("ul",[e("li",{directives:[{name:"show",rawName:"v-show",value:0==t.n,expression:"n == 0"}],staticClass:"addPic",on:{click:t.get_render}},[e("div",[e("i",{staticClass:"el-icon-plus"}),e("el-button",{attrs:{round:""}},[t._v("Add pictures")])],1)]),t._l(t.showPic,(function(i){return e("li",{key:i.id,on:{mouseleave:function(e){return t.conceal(i)}}},[e("el-image",{attrs:{src:t.scenarios[i].pic,fit:"fill"},on:{click:function(e){return t.changImage(t.scenarios[i].pic,i)}}}),e("i",{staticClass:"el-icon-more more",on:{mouseenter:function(e){return t.present(i)}}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.scenarios[i].show,expression:"scenarios[item].show"}],staticClass:"editScenario"},[e("div",[e("img",{attrs:{src:s(8385)},on:{click:function(e){return t.setBg(i)}}}),e("span",[t._v("Background")])]),e("div",[e("img",{attrs:{src:s(8879)},on:{click:function(e){return t.deleteScenario(i)}}}),e("span",[t._v("Delete")])]),e("div",[e("img",{attrs:{src:s(2386)},on:{click:function(e){return t.copyIconStyle(i)}}}),e("span",[t._v("Copy style")])]),e("div",[e("img",{attrs:{src:s(3911)},on:{click:function(e){return t.pasteIconStyle(i)}}}),e("span",[t._v("Paste style")])])]),e("div",{staticClass:"ScenarioName"},[e("el-form",[e("el-form-item",{attrs:{model:t.form}},[e("el-input",{ref:"input",refInFor:!0,model:{value:t.scenarios[i].name,callback:function(e){t.$set(t.scenarios[i],"name",e)},expression:"scenarios[item].name"}})],1)],1),e("i",{staticClass:"icon iconfont icon-baocun",on:{click:function(e){return t.saveScenarioName(i,t.scenarios[i].name)}}})],1)],1)}))],2),e("i",{staticClass:"el-icon-arrow-right",staticStyle:{cursor:"pointer"},on:{click:t.rightMove}})])]),e("el-dialog",{staticClass:"scenarioDialog",attrs:{title:"Gallery",visible:t.addScenarioDialogFormVisible,width:"1100px","modal-append-to-body":!1},on:{"update:visible":function(e){t.addScenarioDialogFormVisible=e}}},[e("ul",{staticClass:"demo-image"},[e("li",{staticClass:"uploadLi"},[e("el-upload",{staticClass:"upload",attrs:{action:"#","auto-upload":!1,"show-file-list":!1,"http-request":t.handelHttp,"on-change":t.handelChange,multiple:"",limit:t.limitPic,"on-exceed":t.handleExceed,"list-type":"picture-card",accept:"JPG,.PNG,.JPEG,.jpg,.png,.jpeg"}},[e("i",{staticClass:"el-icon-plus"})])],1),t._l(t.render_pic,(function(s,i){return e("li",{key:i},[e("el-checkbox",{model:{value:s.check,callback:function(e){t.$set(s,"check",e)},expression:"item.check"}},[e("el-image",{attrs:{src:s.pic,fit:"fill"}})],1)],1)}))],2),e("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){return t.scenarioDialogConfirm()}}},[t._v("Confirm")])],1)],1)])])},o=[],a=(s(7658),s(9872)),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"all"},[t._m(0),e("div",{staticClass:"footer"},[e("ul",t._l(t.devices,(function(s){return e("li",{key:s.id,on:{click:function(e){return t.changeShowComponent(s.id,s.name)}}},[e("el-tooltip",{attrs:{placement:"right",content:s.name,enterable:!1}},[e("el-button",[e("p",{staticClass:"first"},[t._v(t._s(s.name))]),e("p",{staticClass:"second"},[t._v(t._s(s.location))])])],1)],1)})),0)])])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header"},[e("p",[t._v("Device List")])])}],c={data(){return{token:window.sessionStorage.getItem("ha_token"),ha_url:window.sessionStorage.getItem("hass_url"),devices:{},devicesName:[],ws:null,storeDevices:{},manufacturer:[]}},created(){this.manufacturer=this.$store.state.manufacturer,this.$store.commit("setStep","2"),this.ws=this.$store.state.webSocket,this.getDevices(),this.storeDevices=JSON.parse(this.$store.state.devices)},methods:{changeShowComponent(t,e){this.$store.commit("setShow","2"),this.$store.commit("setDeviceId",t),this.$store.commit("setDeviceName",e)},getDevices(){this.$store.commit("setWsId");let t=this.$store.state.wsId,e={id:t,type:"config/device_registry/list"};this.ws.send(JSON.stringify(e)),this.$store.commit("setWsId"),this.ws.onmessage=e=>{this.$store.commit("checkConnection",{param1:e,param2:this});let s=JSON.parse(e.data);if(s.id==t){let t=s.result;for(let e=0;e<t.length;e++){let s=t[e].identifiers[0][0];this.manufacturer.includes(s)&&(this.devicesName.push(t[e].name),this.devices[t[e].name]={},this.devices[t[e].name]["name"]=t[e].name,this.devices[t[e].name]["location"]=t[e].area_id,this.devices[t[e].name]["id"]=t[e].id,this.storeDevices[t[e].id]||(this.storeDevices[t[e].id]={}))}this.devices=JSON.parse(JSON.stringify(this.devices)),this.$store.commit("setDevices",JSON.stringify(this.storeDevices))}}}}},h=c,m=s(1001),l=(0,m.Z)(h,n,r,!1,null,"bfdbb180",null),d=l.exports,p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"all"},[e("div",{staticClass:"header"},[e("i",{staticClass:"el-icon-arrow-left",on:{click:t.back}}),e("p",{attrs:{title:t.deviceName}},[t._v(t._s(t.deviceName))])]),e("div",{staticClass:"footer"},[e("ul",{staticClass:"footer_ul"},t._l(t.entities,(function(s){return e("li",{key:s.id},[e("i",{staticClass:"el-icon-picture-outline edit",attrs:{title:"Custom icon"},on:{click:function(e){return t.selectEntity(s.name,s.id)}}}),e("div",{staticClass:"iconDiv",attrs:{draggable:"true"},on:{dragstart:function(e){return t.dragStart(e,s)}}},[e("img",{directives:[{name:"show",rawName:"v-show",value:s.show_img,expression:"item.show_img"}],attrs:{src:s.img}}),e("span",{directives:[{name:"show",rawName:"v-show",value:!s.show_img,expression:"!item.show_img"}],class:s.icon})]),e("el-tooltip",{staticClass:"item",attrs:{content:s.name,placement:"right"}},[e("p",{staticClass:"name"},[t._v(t._s(s.name))])])],1)})),0),e("el-dialog",{staticClass:"custom_dialog",attrs:{title:"Custom icon",visible:t.customVisible,width:"1100px"},on:{"update:visible":function(e){t.customVisible=e}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"help documentation",placement:"right"}},[e("i",{staticClass:"mdi mdi-help-circle prompt",on:{click:t.toHelp}})]),e("ul",{staticClass:"demo-image"},[e("h1",{directives:[{name:"show",rawName:"v-show",value:t.iconsCustom.length>0,expression:"iconsCustom.length > 0"}]},[t._v("Local icons")]),t._l(t.iconsCustom,(function(s,i){return e("li",{key:i,staticClass:"img_text"},[e("el-radio",{attrs:{label:s,border:""},model:{value:t.pic,callback:function(e){t.pic=e},expression:"pic"}},[e("el-image",{attrs:{src:s,fit:"contain"}})],1)],1)})),e("el-divider",{directives:[{name:"show",rawName:"v-show",value:t.iconsCustom.length>0,expression:"iconsCustom.length > 0"}]}),e("h1",[t._v("HA icons")]),t._l(t.icons,(function(s,i){return e("li",{key:i,staticClass:"img_text"},[e("el-radio",{attrs:{label:"mdi mdi-"+s,border:""},model:{value:t.icon,callback:function(e){t.icon=e},expression:"icon"}},[e("i",{class:"mdi mdi-"+s,staticStyle:{"font-size":"70px","text-align":"center"}})])],1)}))],2),e("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){return t.customDialogConfirm()}}},[t._v("Confirm")])],1)],1)])},g=[],u=s(1273),f={data(){return{token:window.sessionStorage.getItem("ha_token"),ha_url:window.sessionStorage.getItem("hass_url"),devices:{},entities:{},iconsCustom:[],deviceName:"",deviceId:"",projects:"",projectName:"",customVisible:!1,pic:"",selectEntityName:"",ws:"",icons:"",icon:"",selectEntityId:"",manufacturer:[]}},created(){this.initOp(),this.getEntity(),this.projects=JSON.parse(this.$store.state.projects)},computed:{scenario(){return this.$store.state.scenario}},watch:{"$store.state.scenario":function(t){this.scenario=t}},methods:{toHelp(){window.open(this.$store.state.helpIcon,"_blank")},initOp(){this.manufacturer=this.$store.state.manufacturer,this.$store.commit("setStep","2"),this.ws=this.$store.state.webSocket,this.devices=JSON.parse(this.$store.state.devices),this.deviceName=this.$store.state.deviceName,this.deviceId=this.$store.state.deviceId,this.projectName=this.$store.state.projectName,this.icons=this.$store.state.icons,this.projects=JSON.parse(this.$store.state.projects)},selectEntity(t,e){this.selectEntityName=t,this.customVisible=!0,this.selectEntityId=e},customDialogConfirm(){""!=this.pic||""!=this.icon?(""!=this.pic?(this.entities[this.selectEntityName].show_img=!0,this.entities[this.selectEntityName].img=this.pic,this.devices[this.deviceId][this.selectEntityId].show_img=!0,this.devices[this.deviceId][this.selectEntityId].img=this.pic):""!=this.icon&&(this.entities[this.selectEntityName].show_img=!1,this.entities[this.selectEntityName].icon=this.icon,this.devices[this.deviceId][this.selectEntityId].show_img=!1,this.devices[this.deviceId][this.selectEntityId].icon=this.icon),this.$store.commit("setDevices",JSON.stringify(this.devices)),this.customVisible=!1,this.pic="",this.icon=""):this.$message({type:"error",message:"Please select an icon!"})},dragStart(t,e){this.$store.commit("setMoveEntityName",e.name),this.$store.commit("setMoveEntityId",e.id),this.$store.commit("setMoveEntityIcon",e.icon),this.$store.commit("setMoveEntityImg",e.img),this.$store.commit("setMoveEntityShow",e.show_img)},back(){this.$store.commit("setShow","1")},getBase64(t){return new Promise(((e,s)=>{const i=new FileReader;let o="";i.readAsDataURL(t),i.onload=function(){o=i.result},i.onerror=function(t){s(t)},i.onloadend=function(){e(o)}}))},getEntity(){this.$store.commit("setWsId");let t=this.$store.state.wsId,e={id:t,type:"config/entity_registry/list"},s={id:t+1,method:"get",timeout:null,type:"supervisor/api",endpoint:"/addons/core_configurator/info"};this.ws.send(JSON.stringify(e)),this.ws.send(JSON.stringify(s)),this.$store.commit("setWsId"),this.ws.onmessage=e=>{this.$store.commit("checkConnection",{param1:e,param2:this});let s=JSON.parse(e.data);if(s.id==t){let t=s.result;if(Object.keys(this.entities).length)this.$message({type:"error",message:"No entity found!"});else{for(let e=0;e<t.length;e++)this.manufacturer.includes(t[e].platform)&&t[e].device_id==this.deviceId&&(this.entities[t[e].original_name]={},this.entities[t[e].original_name]["name"]=t[e].original_name,this.entities[t[e].original_name]["id"]=t[e].entity_id,this.entities[t[e].original_name]["icon"]="mdi mdi-home",this.entities[t[e].original_name]["show_img"]=!1,this.entities[t[e].original_name]["img"]="",this.devices[this.deviceId][t[e].entity_id]?(this.entities[t[e].original_name]["icon"]=this.devices[this.deviceId][t[e].entity_id].icon,this.entities[t[e].original_name]["show_img"]=this.devices[this.deviceId][t[e].entity_id].show_img,this.entities[t[e].original_name]["img"]=this.devices[this.deviceId][t[e].entity_id].img):this.devices[this.deviceId][t[e].entity_id]={icon:"mdi mdi-home",show_img:!1,img:""});this.entities=JSON.parse(JSON.stringify(this.entities)),this.$store.commit("setDevices",JSON.stringify(this.devices))}}else if(s.id==t+1){let t=s.result,e=this.ha_url+t.ingress_entry+"/api/listdir?path=/config/www";this.$store.state.instance.get(e).then((t=>{let e=t.data.content;for(let s=0;s<e.length;s++)"file"==e[s].type&&this.iconsCustom.push(this.ha_url+"/local/"+e[s].name)})).catch((t=>u.log(t)))}}}}},A=f,v=(0,m.Z)(A,p,g,!1,null,"3f51857e",null),N=v.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aut"},[e("iframe",{staticStyle:{"border-radius":"20px"},attrs:{src:t.automationUrl,scrolling:"no",height:"100%",width:"100%",frameborder:"0"}})])},y=[],j=s(1273),S={data(){return{projects:"",ha_url:window.sessionStorage.getItem("hass_url"),automationUrl:"",automationId:"",instance:null}},created(){this.$store.commit("setStep","3"),this.instance=this.$store.state.instance,this.ge_automation()},methods:{init_automation(t){let e=(new Date).getTime()+Math.floor(1e7*Math.random()),s={alias:t,description:"",trigger:[],condition:[],action:[],mode:"single"};this.instance.post("/api-ha/api/config/automation/config/"+e,s).then((s=>{this.projects[this.$store.state.projectName].scenarios[t]["automation_id"]=e,this.projects[this.$store.state.projectName].scenarios[t]["automation_name"]=t.toString().toLowerCase().replaceAll("-","_"),this.$store.commit("setProjects",JSON.stringify(this.projects)),this.automationUrl="/api-ha/config/automation/edit/"+e,this.ge_automation()})).catch((t=>j.log(t)))},ge_automation(){this.projects=JSON.parse(this.$store.state.projects),this.scenario=this.$store.state.selectScenarioName,j.log(this.projects[this.$store.state.projectName].scenarios[this.scenario].automation_id),this.automationId=this.projects[this.$store.state.projectName].scenarios[this.scenario].automation_id,""!=this.scenario?(this.automationUrl="/api-ha/config/automation/edit/"+this.automationId,this.instance.get(this.automationUrl).then((t=>j.log(t))).catch((t=>{this.init_automation(this.scenario)}))):this.automationUrl="/api-ha/config/automation/edit/new"}},computed:{scenario(){return this.$store.state.selectScenarioName}},watch:{"$store.state.selectScenarioName":function(t){this.scenario=t,this.ge_automation()}}},C=S,_=(0,m.Z)(C,w,y,!1,null,"39cfd8cc",null),O=_.exports,I=s(408),E=s(1273),b={components:{Device:d,Entity:N,Automation:O},data(){return{visitor:null,addScenarioDialogFormVisible:!1,token:window.sessionStorage.getItem("ha_token"),ha_url:window.sessionStorage.getItem("hass_url"),form:{},projects:"",scenarios:"",projectName:"",n:0,left:0,right:2,scenarioList:[],bigImage:"",currentScenario:"",add_icons:{},render_pic:[],planId:"",copyStyle:{},instance:"",limitPic:10}},created(){this.initOp()},methods:{initOp(){this.$store.commit("setAutoState",!0),this.$store.commit("setScenarioState",!1),this.visitor=JSON.parse(JSON.stringify(this.$store.state.visitor)),this.$store.commit("setStep","2"),this.planId=this.$store.state.planId,this.form.name=this.$store.state.projectName,this.projects=JSON.parse(this.$store.state.projects),this.projectName=this.$store.state.projectName,this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)),this.scenarioList=this.projects[this.projectName].scenarioList,this.bigImage=this.projects[this.projectName].default,this.instance=this.$store.state.instance},handleExceed(t,e){this.$message.warning(`The current limit is to select ${this.limitPic} images, but you have selected ${t.length} images this time.`)},async handelChange(t,e){let s;try{s=await this.getBase64(t.raw)}catch{E.log("err1")}let i=(new Date).getTime()+Math.floor(1e7*Math.random());await this.init_automation(i),this.projects[this.projectName].scenarioList.push(i),this.projects[this.projectName].scenarios[i]={name:i,pic:s,add_pic:{},add_icons:{},automation_id:"",automation_name:"",show:!1},this.projects=JSON.parse(JSON.stringify(this.projects)),this.scenarioList=this.projects[this.projectName].scenarioList,this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)),E.log(this.projects),this.left=0,this.right=2,this.$store.commit("setProjects",JSON.stringify(this.projects)),this.addScenarioDialogFormVisible=!1,this.$message({showClose:!1,message:"Successfully added",type:"success",center:!0,duration:3e3})},update(){this.$store.commit("setProjects",JSON.stringify(this.projects)),this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)),this.scenarioList=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarioList)),this.$store.dispatch("saveConfig",this)},conceal(t){1==this.scenarios[t].show&&(this.scenarios[t].show=!1,this.scenarios=JSON.parse(JSON.stringify(this.scenarios)),this.projects=JSON.parse(this.$store.state.projects),this.update())},present(t){this.scenarios[t].show=!0,this.scenarios=JSON.parse(JSON.stringify(this.scenarios))},pasteIconStyle(t){0!=Object.keys(this.copyStyle).length?(this.projects[this.projectName].scenarios[t].add_icons=JSON.parse(JSON.stringify(this.copyStyle)),this.$store.commit("setProjects",JSON.stringify(this.projects)),this.add_icons=this.projects[this.projectName].scenarios[t].add_icons,this.$message({type:"success",message:"Icon pasted successfully!"})):this.$message({type:"error",message:"No icon has been copied!"})},copyIconStyle(t){this.copyStyle=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios[t].add_icons)),this.$message({type:"success",message:"Icon copied successfully!"})},setBg(t){this.$confirm("Do you want to set this scenario as the default?","Prompt",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then((()=>{this.bigImage=this.scenarios[t].pic,this.projects[this.projectName].default=this.bigImage,this.projects[this.projectName].defaultScenario=t;for(let e=0;e<this.scenarioList.length;e++)if(this.scenarioList[e]==t){this.scenarioList.splice(e,1);break}this.scenarioList.unshift(t),this.projects[this.projectName].scenarioList=this.scenarioList,this.$store.commit("setProjects",JSON.stringify(this.projects)),this.projects=JSON.parse(this.$store.state.projects),this.scenarioList=this.projects[this.projectName].scenarioList,this.$message({type:"success",message:"Set successfully!"})})).catch((()=>{this.$message({type:"info",message:"Setting canceled"})}))},deleteScenario(t){this.$confirm("Do you want to delete this scenario?","Prompt",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then((()=>{if(this.projects[this.projectName].defaultScenario!=t){this.currentScenario==t&&this.$store.commit("setShow","1"),this.instance.delete("/api-ha/api/config/automation/config/"+this.projects[this.projectName].scenarios[t].automation_id);for(let e=0;e<this.scenarioList.length;e++)if(this.scenarioList[e]==t){this.scenarioList.splice(e,1);break}this.left=0,this.right=2,this.projects[this.projectName].scenarioList=this.scenarioList,delete this.scenarios[t],this.projects[this.projectName].scenarios=this.scenarios,this.icons={},this.add_icons={},this.$store.commit("setSelectScenarioName",""),this.bigImage=this.projects[this.projectName].default,this.update(),this.scenarioList=this.projects[this.projectName].scenarioList,this.$message({type:"success",message:"Successfully deleted!"}),this.currentScenario="",this.$store.commit("setAutoState",!0)}else this.$message({type:"error",message:"The background image cannot be deleted!"})})).catch((()=>{this.$message({type:"info",message:"Deletion canceled"})}))},validate(t){const e=/^[a-zA-Z0-9_]+$/;return e.test(t)},saveScenarioName(t,e){if(this.projects=JSON.parse(this.$store.state.projects),this.scenarioList.includes(this.scenarios[t].name))this.$message({showClose:!1,message:"Duplicate scenario name",type:"error",center:!0,duration:1e3}),this.scenarios[t].name=t;else if(this.validate(e)){t==this.projects[this.projectName].defaultScenario&&(this.projects[this.projectName].defaultScenario=e);let s=this.projects[this.projectName].scenarios[t].automation_id;s&&this.instance.get("/api-ha/api/config/automation/config/"+s).then((t=>{let s=t.data,i=s.alias.toString().toLowerCase().replaceAll("-","_"),o={area_id:null,entity_id:"automation."+i,icon:null,id:this.$store.state.wsId,name:e,new_entity_id:"automation."+i,type:"config/entity_registry/update"};this.$store.commit("setWsId"),this.$store.state.webSocket.send(JSON.stringify(o)),this.$store.commit("setWsId")})),this.projects[this.projectName].scenarios[e]=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios[t])),delete this.projects[this.projectName].scenarios[t],this.projects[this.projectName].scenarios[e].name=e;for(let i=0;i<this.scenarioList.length;i++)if(this.scenarioList[i]==t){this.scenarioList.splice(i,1,e);break}this.projects[this.projectName].scenarioList=this.scenarioList,this.projects=JSON.parse(JSON.stringify(this.projects)),this.update(),this.$store.state.selectScenarioName==t&&this.$store.commit("setSelectScenarioName",e),this.$message({showClose:!1,message:"Modification successful",type:"success",center:!0,duration:3e3})}else this.$message({showClose:!1,message:"The scenario name can only contain letters, numbers  and _",type:"error",center:!0,duration:4e3}),this.scenarios[t].name=t},saveProjectName(){this.projectName in Object.keys(this.projects)?(this.$message({showClose:!1,message:"Duplicate project name",type:"error",center:!0,duration:1e3}),this.projectName=this.$store.state.projectName):(this.projects[this.projectName]=JSON.parse(JSON.stringify(this.projects[this.$store.state.projectName])),this.projects[this.projectName].name=this.projectName,delete this.projects[this.$store.state.projectName],this.projects=JSON.parse(JSON.stringify(this.projects)),this.$store.commit("setProjectName",this.projectName),this.$store.commit("setProjects",JSON.stringify(this.projects)),this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)),this.scenarioList=this.projects[this.projectName].scenarioList,this.currentScenario="",this.$store.commit("setAutoState",!0),this.bigImage="",this.$store.commit("setShow","1"),this.add_icons={},this.$message({showClose:!1,message:"Modification successful",type:"success",center:!0,duration:3e3}))},init_automation(t){let e=(new Date).getTime()+Math.floor(1e7*Math.random()),s={alias:t,description:"",trigger:[],condition:[],action:[],mode:"single"};this.instance.post("/api-ha/api/config/automation/config/"+e,s).then((s=>{this.projects[this.$store.state.projectName].scenarios[t]["automation_id"]=e,this.projects[this.$store.state.projectName].scenarios[t]["automation_name"]=t.toString().toLowerCase().replaceAll("-","_"),E.log(this.projects),this.$store.commit("setProjects",JSON.stringify(this.projects))})).catch((t=>E.log(t)))},async scenarioDialogConfirm(){let t=(new Date).getTime()+Math.floor(1e7*Math.random());for(let e=0;e<this.render_pic.length;e++)1==this.render_pic[e].check&&(t+=1,this.projects[this.projectName].scenarioList.push(t),this.projects[this.projectName].scenarios[t]={name:t,pic:this.render_pic[e].pic,add_pic:{},add_icons:{},show:!1,automation_id:"",automation_name:""},await this.init_automation(t));this.projects=JSON.parse(JSON.stringify(this.projects)),this.scenarioList=this.projects[this.projectName].scenarioList,this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)),this.left=0,this.right=2,this.$store.commit("setProjects",JSON.stringify(this.projects)),this.addScenarioDialogFormVisible=!1,this.$message({showClose:!1,message:"Successfully added",type:"success",center:!0,duration:3e3})},get_render:(0,a.Z)((function(){this.render_pic=[];const t=async()=>{let t={obsDesignId:this.planId},e=await this.$axios.get("/api-ks/koolsmart/api/site/design/designrenderpics",{params:t});if(0!=e.data.renderPics.length){this.addScenarioDialogFormVisible=!0;for(let t=0;t<e.data.renderPics.length;t++){let s=1;for(let i=0;i<this.render_pic.length;i++)if(e.data.renderPics[t]==this.render_pic[i].pic){s=0;break}s&&this.render_pic.push({pic:e.data.renderPics[t],check:!1})}}else this.$message.error("No rendered image found")};if(this.$store.state.isVisitor){this.addScenarioDialogFormVisible=!0;for(let t=0;t<this.visitor.renderPics.length;t++){let e=1;for(let s=0;s<this.render_pic.length;s++)if(this.visitor.renderPics[t]==this.render_pic[s].pic){e=0;break}e&&this.render_pic.push({pic:this.visitor.renderPics[t],check:!1})}}else t()})),dragStart(t){this.$store.commit("setMoveEntityName",t.name),this.$store.commit("setMoveEntityId",t.id),this.$store.commit("setMoveEntityIcon",t.icon),this.$store.commit("setMoveEntityImg",t.img),this.$store.commit("setMoveEntityShow",t.show_img)},drop(t){if(""!=this.currentScenario){let e=document.getElementsByClassName("image")[0],s=e.getBoundingClientRect().left,i=e.getBoundingClientRect().top;this.add_icons[this.moveEntityId]={},this.add_icons[this.moveEntityId]["id"]=this.moveEntityId,this.add_icons[this.moveEntityId]["left"]=t.clientX-s-15+"px",this.add_icons[this.moveEntityId]["top"]=t.clientY-i-15+"px",this.add_icons[this.moveEntityId]["show_img"]=this.moveEntityShow,this.add_icons[this.moveEntityId]["icon"]=this.moveEntityIcon,this.add_icons[this.moveEntityId]["img"]=this.moveEntityImg;let o=((t.clientX-s)/e.offsetWidth*100).toFixed(2),a=((t.clientY-i)/e.offsetHeight*100).toFixed(2);o<0&&(o=0),a<0&&(a=0),o+="%",a+="%",this.add_icons[this.moveEntityId]["left_percent"]=o,this.add_icons[this.moveEntityId]["top_percent"]=a,E.log(this.add_icons[this.moveEntityId]),this.add_icons=JSON.parse(JSON.stringify(this.add_icons)),this.projects[this.projectName].scenarios[this.currentScenario]["add_icons"]=this.add_icons,this.$store.commit("setProjects",JSON.stringify(this.projects))}else this.$message({showClose:!1,message:"Please select a scenario first",type:"error",center:!0,duration:3e3})},dragOver(t){t.preventDefault()},changImage(t,e){this.projects=JSON.parse(this.$store.state.projects),this.$store.commit("setSelectScenarioName",e),this.bigImage=t,this.currentScenario=e,this.$store.commit("setAutoState",!1),this.add_icons=this.projects[this.projectName].scenarios[e].add_icons},leftMove(){0!=this.n?(this.n--,0==this.n?(this.left=0,this.right=2):(this.left-=3,this.right=this.left+3),this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios))):this.$message({message:"This is already the first page",type:"warning"})},rightMove(){this.scenarioList.length<=this.right?this.$message({message:"This is already the last page",type:"warning"}):(this.n++,this.left=2+3*(this.n-1),this.right=this.left+3,this.scenarios=JSON.parse(JSON.stringify(this.projects[this.projectName].scenarios)))},getBase64(t){return new Promise(((e,s)=>{const i=new FileReader;let o="";i.readAsDataURL(t),i.onload=function(){o=i.result},i.onerror=function(t){s(t)},i.onloadend=function(){E.log(o),e(o)}}))}},computed:{show(){return this.$store.state.show},showPic(){return this.right>this.scenarioList.length&&(this.right=this.scenarioList.length),this.scenarioList.slice(this.left,this.right)},...(0,I.rn)(["moveEntityId","moveEntityImg","moveEntityIcon","moveEntityShow"])},watch:{"$store.state.show":function(t){E.log(t),this.show=t}}},J=b,$=(0,m.Z)(J,i,o,!1,null,"0cf5da23",null),k=$.exports},9872:function(t,e,s){function i(t){let e=!0;return function(){e&&(e=!1,t.call(this,arguments),setTimeout((()=>{e=!0}),2e3))}}s.d(e,{Z:function(){return i}})},2386:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAzJJREFUWEfNlz1MU1EUx//ntTUPLQpJP3QEnDBVB0NKTUh0koAObrSjupBA4mLdcASXJsAGHRjEsDjoAotuYtDBj8SBWDswmL73CE3AiL7HO+ZeeaSFvr4HFuudmt7/Pef3zr333HMIPoemaWEiugngOoAEM3cpitImltu2XSaiAoBPAF4y84tYLLblxzR5icrlcpdpmg8BDAE45aXfnf8O4GkoFBpva2sTYK7DFWBtba1FVdVHAO4DCPl0vF9mAshFIpExItquZaMmQKlU6iKiZ0R08YiOq5Yx80dmvh2Pxw9E4wDAxsbGZcuyFgHEG+G8wkYpGAzeaG9vf19ptwqgVCp1Kory+hicOz5Ltm2n4vH4V+ePPYBisaiGw+E3AC41+Mv3m/uwtbWV7OjokGdiD8AwjHFmzh6zc8f842g0Kn1JAHHVLMv6zMwnvACmpqYwPz+PnZ2dutJAIIB0Oo2RkZEDOiL6FQwGu8UVlQCaps0Q0V0v52I+mUyKxONHCgGxvLzspp2NRqP3aH19/bRt298AnPRjtaenR8qEYeGg1hDR6e3tlVMrKys1Ncz8IxAInCVd10WGm/fjXGgcADfDjh2fuowAmAHgGv6lpSUsLCzAsiwMDQ1hbGys7pcdEiAvAN4CuOIWgb6+Pmxvb2NwcFACZDKZRgK8EwA6gIgbgBPK6elpGX6fofWr08kwDJOZg00C+Nl8gKNuwd9ew92I656HcP8ZaGAiEgzyEM4CuOP3DORyOXktvbKhoigyFY+OjtZLMfIapgE88QvgpltdXUWhUEB/f7/fnCZ0GSoUCmdaW1u/EVFLrZXOFgwPD6O7u9vV+OLiogSYm5vzBSBS8ebm5jn5GNXLhqlUSmZBPyORSCCfz/uRCs2fx0j8qvccT05OyufXa89VVUU2m8XAwIAngHiObdu+EIvFvuwVJLquTwB44Lm6MYLqgkTYZGbVMIx/UpJFIpGkU6ZXFaXlcrnTNM3jLkqvVpbn/1dZ7mxvUxsTB6KprVnlQdc07TwRiRL60M0pM0+Iq1bv4nh2x87i3fb8FoBrRCTbcwDtAER9LtrzIjOL9vwVMz/3257/BjUpqHsoj2tbAAAAAElFTkSuQmCC"},8385:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAA4dJREFUWEfNV01IW1sQ/iYSo5UQRW9ChCy0LqT6quUJ79G3qXVjQbrorumydefCirRbwYVYFP9/mwci1C6EIqUguChd2FqwRahSN7VduCi5V6y1PGNqvVPmmptGm5irieTNKrln5ptv5sw5Z4ZgUTRNcwJoAHAVwB/MfJ6ICsScmb8Q0RqAZQDPATxTFOWbFWhKpqSqahkR3QdwE0BeMv3I+n8AHjNzp9vt/nCcTUIC6+vruTk5OW0A7gKwW3R8VG0PQM/u7m6bz+cLxcOISyAYDEp6nxDRxVM6PmTGzO+Y+YbH45FtOiS/EVBV9RIRzQLwpMN5DEaQma+53e6lWNxDBILBYKnNZnt1Bs5Nn0G73X45Pz//o/khSoCZczY2Nl4DqEpz5L9th6IofxHRrixECWia1gng3lk6j8F+oCiKnKwDApGj9j6Faj8p7z1mviBH1CCgadpDAHdOipKifkBRlEZaW1tzOZ3Oz0SUmyKgYa7rOrq6ujA7Owu/34/GxsZEsKHt7W0vaZomN9xUOpwzMzo6OjAzM2PA2e12zM/PgyjhfXdLCKQl/eJcIp+eno7GUltbi85Oqe2E8q8QeAPgz1Qz0Nvbi6mpX4msqalBT08PHA7HcdBvSVXVDSIqTKS1urqKubk51NXVobKyMq7a8PAwJiYmomtVVVXo7+9Hbm7SstIkAz8AZMVDloKqr6/H1taWEYlEJJHFSiAQwPj4ePRTRUUFBgcHkZdn6eH8fiwB2deGhgY5poYDiaivrw/V1dXG/8nJScOZKeXl5RgaGoLTKa2DJfmedAtWVlbQ1NSEnZ0dA1EiGxgYwPLyspERU8rKyjAyMgKXy2XJc0TJ2IKkRbi0tITm5maEQgdPumTC/C3/S0pKMDo6ioICo0E6ibwVAgEAt5NZLS4uoqWlBeFw+JCqz+fD2NgYioqKkkHEWzeOoR/AIyvWCwsLaG1txd6eNDpAcXGx4dzjOXXrcIs2Nzdd+/v7nyWzVkjIzdbe3o7CwkJ0d3fD6/VaMYunE8rKyvJm/jESapl4jrOzsy+4XK6D51gkow2JEJA23OFwvE5XJ5yoMKRDDofDf5tt+tGm9LzNZnt5lk2pruv/xLbn/6+23ExbRgcTk0RGR7PYAjKHU2b2E9E5K7cOM+8Q0VRKw+lRR5Hx/DqAKwBkZiyNjOf7uq5/JaJPAN4BeAHgqdXx/CfDG3iDJ/5UEgAAAABJRU5ErkJggg=="},8879:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAuRJREFUWEfNVz1MU1EU/k55Na0WbZPXPh0BYdCoJXEgOmlC0kUHN0sIg7rTBNRNRjAQYQYXfnRz0KVh0M2YaMCfxKm1AwN5P4Qm1FR99R1zH7ymP/xcTGm5433nfN93z73nvHMIksswjBAR3QJwE8AlZu7y+Xxh4e44Tp6IsgC+AXjLzG9isVhBBpoOMsrn8122bT8GcBfAqYPsd77/BPDS7/ePh8NhIWzPtaeAtbW1YCAQGAOQAuCXJK41swE8U1X1CRH92g1jVwG6rncR0SsiuvyfxFVuzPyVme9omlYXjToBm5ub8VKplAagNYK8AkNXFCURiUQ+V+JWCdB1vdPn870/AnKPU3cc55qmaT+8jbKAXC4XCIVCHwBcafDJa+G+FAqFvo6ODvdNlAVYljXOzI+OmNyDfxqNRl0uV4BItVKp9J2ZTzRDABH9URTlgkhRV4BhGLNEdL8Z5BUcc9Fo9AFtbGycdhxnHcDJZgpg5mJbW9tZMk1TVLgXMuQLCwtIp9MYHR1FPB6vclldXcXk5CQSiQQGBwdl4ITNgBAwC0Aq/MlkEplMBsFgENPT0+jt7XWJVlZWkEqlUCwW0dPTg8XFRVkBz4WAjwCuyniIUw4PD7tEnghmLpOLvZmZmbro7IP9SQgwAagyAmpPKwjFqhTkRUUSzyTLsmxmViQd6kIuNmqv5BBYv1svoOVXcBwe4RyAezL3JpOG3d3dWFpakoETNm4aJgFIeczPz2N5eRkjIyO7FqKpqSn09/djaGhIVsAAZbPZM+3t7etEtJ1TTVqiFG9tbZ1zf0aHqYYN1Lf9MxKArfgdO45zMRaLZcoNiWmaEwAeNvCE+0FVNyTCkpkDlmU1pSVTVbXPa9OrmtJ8Pt9p2/ZRN6XXK9vz49WWe5fW0sHEE9HS0azy+RqGcZ6IRAt96OGUmSdEqu2XDgdOx57zznh+G8ANInLHcwARAH9FKSGiHDOL8fwdM7+WHc//AYxzlntSPtBPAAAAAElFTkSuQmCC"},3911:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAthJREFUWEfNlztTE1EUx/8nbCRo0GRmk9USsMGMj8JhGK2kskAKqTSl+gFsDJ3ShTR8ALDEdBbaWCWdOGihZrAypqBg9sGwDBEfG/c4d2GZBELuBoF1y7vnnvO7954nIeBnGEaciO4AGANwmZmHIpFIQmx3XdcmoiqACoASM79Op9P1IKpJJmTb9pDjOFMA7gE4I5Pf+f8dQDEajeYTiYQAO/A7EGBlZaUvFos9A/AYQDSg4b1iDoBZVVWfEtHPdjraAui6PkREL4noyiENt2xj5s/MfFfTtH23sQ9gfX39WqPReANAOwrjTTp0RVFuJ5PJj816WwB0XR+MRCJvj8G4b1N3XfeGpmnf/IVdgFqtFovH4+8AXD3ik+9V96ler48ODAx4PrELYFlWnplzx2zcV19IpVKeLQ9AhFqj0fjCzKdOAoCIfiuKckmEqAdgGMYcET1sZ3xkZKRlube3F7lcDuPj4//KOp9KpR7R2traWdd1VwGcDgLgy0xOTmJiYkIKMTw83FaGmX/09PScJ9M0RYZ7cZAm/way2SwymQwqlQqKxaLUsC+wtLTUSTYrAOYAtL1+sdMHyOfzGBsTZQAol8uYnp7G1taWFEQC8FwAvAdwXXYDzQBCdmNjA/V6+3qzuLiIQqHgqZQAfBAAJgC1W4BORy+VSpiaEvVLCmCSZVkOMyshAfwKHyD0JzisEx6RD3hOOA/gQUg+4IXhfQALMgA/EUkDH8Dy8jIWFrZVShNRtVo919/fv0pEfd2k4iAgnQBEKt7c3LzgFaNO2XBvMQpqOEAq3i5GQjCMcuy6biadTn/dbUhM05wB8KTbEx5SvrUhEUqYOWZZ1om0ZKqqjvptektTatv2oOM4x92U3mxuz/+vttx/z1AHEx8i1NGs2bMNw7hIRKKF7no4ZeYZEWqdIkU6Hfubd8Zz0YXeIiJvPAeQBPBHpBIiqjGzGM/LzPwq6Hj+F/RXgXv5V0CbAAAAAElFTkSuQmCC"}}]);
//# sourceMappingURL=956.67c51c7f.js.map